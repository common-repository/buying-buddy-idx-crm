<?phpif ( ! defined( 'ABSPATH' ) ) exit; // Exit if accessed directly   // Shortcode to Generate a select box containing lookup values for a field function buyingbuddy_lookup_shortcode($atts){     global $buyingbuddyObj;       // Attributes    $atts = shortcode_atts(        array(            'field'         => '',            'mls_id'        => '',            'default_text'  => ''        ),        $atts    );     $atts["field"] = wp_kses_post($atts["field"]);    $atts["mls_id"] = sanitize_text_field($atts["mls_id"]);    $atts["default_text"] = wp_kses_post($atts["default_text"]);    if (empty($atts["default_text"])) $atts["default_text"] = "Choose";        $lookup_content = "";    if (!empty($atts["field"]) && !empty($atts["field"])){        $lookups = $buyingbuddyObj->getFieldLookupValues($atts["mls_id"],$atts["field"]);        if (array($lookups)) {            $lookup_content = "                <select name='".esc_html($atts["field"])."[]' class='mbb-select2' multiple>                    <option value=''>".esc_html($atts["default_text"])."</option>";            foreach($lookups->lookups as $lookup) {               $lookup_content  .= "<option value='".esc_html($lookup->key)."'>".esc_html($lookup->value)."</option>\n";             }             $lookup_content .= "                </select>";        }    }    return $lookup_content;   }// Shortcode to return MBB Widget contentfunction buyingbuddy_widget_shortcode($atts, $content=null, $code=""){    global $buyingbuddyObj, $widgetHTML, $detailsHTML, $buyingbuddy_options, $post, $team_office, $team_agent;    if (isset($atts['filter'])) $atts['filter'] = wp_kses_post($atts['filter']);    else $atts['filter'] = "";    if (isset($atts['limit'])) $atts['limit']  = wp_kses_post($atts['limit']);    else $atts['limit'] = "";    if (isset($atts['order'])) $atts['order']  = wp_kses_post($atts['order']);    else $atts['order'] = "";    if (isset($atts['style'])) $atts['style']  = wp_kses_post($atts['style']);    else $atts['style'] = "";    if (isset($team_office)) $team_office  = wp_kses_post($team_office);    else $team_office = "";    if (isset($team_agent)) $team_agent  = wp_kses_post($team_agent);    else $team_agent = "";                    $atts['id']     = sanitize_text_field($atts['id']);    $property_id    = sanitize_text_field(get_query_var('property_id'));    if ($atts['id'] != "MBBv3_SearchDetails") {        $widgetParams = "";        if (isset($_SERVER['REQUEST_URI'])) {            $qStr = sanitize_url($_SERVER['REQUEST_URI']);            if (preg_match("/filter=([^&]+)&?/",$qStr,$found)) $atts['filter'] = $found[1];                }                if (!empty($_GET['limit'])) $atts['limit'] = (sanitize_text_field($_GET['limit']));        elseif (empty($atts['limit'])) $atts['limit'] = "";                    if (!empty($_GET['order'])) $atts['order'] = (sanitize_text_field($_GET['order']));        elseif (empty($atts['order'])) $atts['order'] = "";                $widgetParams = array(            'filter'        =>  $atts['filter'],            'limit'         =>  $atts['limit'],            'order'         =>  $atts['order'],            'style'         =>  $atts['style'],            'property_id'   => $property_id,            'page'          =>  1,        );        if($atts['id'] == "MBBv3_OfficeRoster") {            if ($team_office == "list") {                $widget_page = "index";            } elseif ($team_office) {                if (preg_match("/search$/",$team_office)) $team_office .= "/";                $widget_page = "roster/".$team_office;            } elseif ($team_agent) {                $widget_page = "agent/name/".$team_agent;            }        } else $widget_page = "index";                    $widgetHTML    = $buyingbuddyObj->getWidget($atts['id'], $widgetParams, $widget_page);        $widget = '<div id="'.$atts['id'].'" filter="'.$atts['filter'].'" limit="'.$atts['limit'].'" order="'.$atts['order'].'" style="'.$atts['style'].'" >'.$widgetHTML->html.'        <!-- '.$widgetHTML->curlUrl.' -->        </div>';    } else {                if (is_object($detailsHTML))  $widget = '<div id="MBBv3_SearchDetails">'.$detailsHTML->html."        <!-- ".$detailsHTML->curlUrl." -->        </div>";         else $widget = '<div id="MBBv3_SearchDetails"></div>';      }    return $widget;}?>